# Инструкция по запуску тестов интерфейса

## Описание

Созданы комплексные тесты для проверки работы интерфейса StockPredictor. Тесты покрывают:

### 1. Основные функции интерфейса (`tests_ui.py`)

#### DashboardUITests - Тесты главной панели управления
- Проверка требования авторизации
- Загрузка страницы для авторизованных пользователей
- Наличие обязательных элементов интерфейса
- API эндпоинт для метрик

#### ProcurementUITests - Тесты модуля закупок
- Загрузка главной страницы закупок
- Отображение рекомендаций
- Работа таблицы закупок
- Фильтрация по категориям
- Фильтрация по статусу здоровья
- Поиск по SKU и названию
- Экспорт в CSV
- Быстрое создание заказов

#### LoginUITests - Тесты авторизации
- Загрузка страницы логина
- Вход с корректными данными
- Вход с неправильными данными
- Функциональность выхода
- Переадресация авторизованных пользователей

#### PurchaseOrderUITests - Тесты заказов на закупку
- Загрузка детальной страницы заказа
- Обновление статуса заказа
- Фильтрация по статусу
- Фильтрация по периоду
- Поиск заказов

#### HTMXIntegrationTests - Тесты HTMX интеграции
- Возврат частичных шаблонов для HTMX
- Возврат полных шаблонов для обычных запросов

#### ResponsiveUITests - Тесты адаптивности
- Наличие классов адаптивности на дашборде
- Адаптивность таблицы закупок

#### ErrorHandlingUITests - Тесты обработки ошибок
- 404 для несуществующих продуктов
- 404 для несуществующих заказов
- Обработка неправильных статусов

#### PaginationUITests - Тесты пагинации
- Пагинация таблицы закупок
- Переход между страницами
- Пагинация заказов

### 2. Интеграционные тесты (`tests_integration.py`)

#### OrderCreationWorkflowTests - Тесты создания заказов
- Полный цикл создания заказа
- Быстрое создание заказа

#### FilterAndSearchWorkflowTests - Тесты фильтров и поиска
- Комбинация нескольких фильтров
- Комбинация поиска и фильтра
- Сброс фильтров

#### DashboardDataIntegrationTests - Тесты данных дашборда
- Расчет метрик
- Корректность статистики

#### ExportIntegrationTests - Тесты экспорта
- Экспорт с фильтрами
- Формат CSV файла

#### UserAccessControlTests - Тесты контроля доступа
- Изоляция данных между компаниями
- Ограничение доступа к чужим продуктам
- Ограничение доступа к чужим заказам

#### StatusWorkflowTests - Тесты жизненного цикла статусов
- Последовательность изменения статусов
- Фильтрация по разным статусам

#### UIPerformanceTests - Тесты производительности
- Загрузка с большим количеством данных
- Производительность API

## Запуск тестов

### Вариант 1: Запуск всех UI тестов
```powershell
python manage.py test tests_ui
```

### Вариант 2: Запуск всех интеграционных тестов
```powershell
python manage.py test tests_integration
```

### Вариант 3: Запуск всех тестов сразу
```powershell
python manage.py test tests_ui tests_integration
```

### Вариант 4: Запуск конкретного класса тестов
```powershell
# Тесты дашборда
python manage.py test tests_ui.DashboardUITests

# Тесты закупок
python manage.py test tests_ui.ProcurementUITests

# Тесты авторизации
python manage.py test tests_ui.LoginUITests

# Интеграционные тесты создания заказов
python manage.py test tests_integration.OrderCreationWorkflowTests
```

### Вариант 5: Запуск конкретного теста
```powershell
# Пример: тест загрузки дашборда
python manage.py test tests_ui.DashboardUITests.test_dashboard_page_loads_for_authenticated_user

# Пример: тест фильтрации
python manage.py test tests_ui.ProcurementUITests.test_buying_table_filter_by_category
```

### Вариант 6: Запуск с подробным выводом
```powershell
python manage.py test tests_ui tests_integration --verbosity=2
```

### Вариант 7: Использование pytest (если установлен)
```powershell
# Все тесты
pytest tests_ui.py tests_integration.py -v

# Конкретный файл
pytest tests_ui.py -v

# Конкретный класс
pytest tests_ui.py::DashboardUITests -v

# Конкретный тест
pytest tests_ui.py::DashboardUITests::test_dashboard_page_loads_for_authenticated_user -v
```

## Покрытие тестами

### Основные компоненты интерфейса:
- ✅ Главная панель управления (Dashboard)
- ✅ Модуль закупок (Procurement)
- ✅ Таблица закупок (Buying Table)
- ✅ Заказы на закупку (Purchase Orders)
- ✅ Авторизация (Login/Logout)

### Функциональность:
- ✅ Фильтрация и поиск
- ✅ Пагинация
- ✅ Создание заказов
- ✅ Экспорт данных
- ✅ HTMX интеграция
- ✅ Адаптивный дизайн
- ✅ Обработка ошибок
- ✅ Контроль доступа
- ✅ Производительность

## Результаты тестов

При успешном прохождении всех тестов вы должны увидеть:
```
Ran XX tests in X.XXs

OK
```

При наличии ошибок тесты покажут:
- Какой именно тест провалился
- В какой строке произошла ошибка
- Ожидаемое и фактическое значение
- Трассировку стека

## Отладка проблем

### Если тесты не запускаются:
1. Проверьте установку зависимостей:
   ```powershell
   pip install -r requirements.txt
   ```

2. Убедитесь что БД настроена:
   ```powershell
   python manage.py migrate
   ```

3. Проверьте переменные окружения в `.env` файле

### Если конкретный тест падает:
1. Запустите только этот тест с подробным выводом:
   ```powershell
   python manage.py test tests_ui.ClassName.test_name --verbosity=2
   ```

2. Проверьте данные в тестовой БД
3. Проверьте логи приложения

## Дополнительные команды

### Проверка покрытия кода тестами (требует coverage):
```powershell
pip install coverage
coverage run --source='.' manage.py test tests_ui tests_integration
coverage report
coverage html
```

### Запуск тестов в параллельном режиме:
```powershell
python manage.py test --parallel
```

## Рекомендации

1. **Запускайте тесты регулярно** - после каждого изменения в коде
2. **Используйте --keepdb** для ускорения повторных запусков:
   ```powershell
   python manage.py test tests_ui --keepdb
   ```
3. **Проверяйте производительность** - тесты не должны выполняться слишком долго
4. **Добавляйте новые тесты** при добавлении новой функциональности

## Типичные проблемы и решения

### Проблема: "No such table"
**Решение:** Запустите миграции:
```powershell
python manage.py migrate
```

### Проблема: "Authentication credentials were not provided"
**Решение:** Проверьте что в тесте используется `self.client.login()`

### Проблема: "404 Not Found"
**Решение:** Проверьте правильность URL в `urls.py` и название view

### Проблема: Тесты проходят локально, но падают на CI/CD
**Решение:** Проверьте различия в настройках окружения и версиях зависимостей

## Контакты

При возникновении проблем с тестами:
1. Проверьте документацию Django Testing
2. Изучите вывод ошибок
3. Проверьте логи приложения
